<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-10-21 Sat 09:48 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HTCondor@IAC User's Manual</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Ángel de Vicente" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">HTCondor@IAC User's Manual</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#Introduction">1. Introduction</a>
<ul>
<li><a href="#What%20is%20HTCondor%3F">1.1. What is HTCondor?</a></li>
<li><a href="#How%20can%20HTCondor%20help%20me%3F">1.2. How can HTCondor help me?</a></li>
<li><a href="#How%20%2Apowerful%2A%20is%20HTCondor%3F">1.3. How <b>powerful</b> is HTCondor?</a></li>
<li><a href="#Which%20machines%20are%20part%20of%20HTCondor%3F">1.4. Which machines are part of HTCondor?</a></li>
<li><a href="#How%20can%20I%20use%20HTCondor%3F">1.5. How can I use HTCondor?</a></li>
<li><a href="#Where%20will%20my%20application%20run%3F">1.6. Where will my application run?</a></li>
<li><a href="#Basic%20HTCondor%20workflow">1.7. Basic HTCondor workflow</a></li>
</ul>
</li>
<li><a href="#Submit%20files">2. Submit files</a>
<ul>
<li><a href="#Submit%20files--Introduction">2.1. Introduction</a></li>
<li><a href="#%2FSubmit%20files%2F%20syntax">2.2. <i>Submit files</i> syntax</a>
<ul>
<li><a href="#Comments">2.2.1. Comments</a></li>
<li><a href="#Variables%20and%20macros">2.2.2. Variables and macros</a></li>
<li><a href="#Submit%20commands">2.2.3. Submit commands</a></li>
</ul>
</li>
<li><a href="#Examples">2.3. Examples</a>
<ul>
<li><a href="#HTCondor%20%2FHello%20World%21%2F">2.3.1. HTCondor <i>Hello World!</i></a></li>
<li><a href="#Similar%20jobs%20with%20one%20%3DQueue%3D%20command">2.3.2. Similar jobs with one <code>Queue</code> command</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Main%20HTCondor%20commands">3. Main HTCondor commands</a>
<ul>
<li><a href="#Checking%20pool%20status">3.1. Checking pool status</a></li>
<li><a href="#Submitting%20jobs">3.2. Submitting jobs</a></li>
<li><a href="#Checking%20and%20managing%20submitted%20jobs">3.3. Checking and managing submitted jobs</a></li>
<li><a href="#Getting%20information%20from%20the%20logs">3.4. Getting information from the logs</a></li>
<li><a href="#Other%20commands">3.5. Other commands</a></li>
<li><a href="#HTCondor%20from%20Python">3.6. HTCondor from Python</a></li>
</ul>
</li>
<li><a href="#How-to%20Recipes">4. How-to Recipes</a>
<ul>
<li><a href="#HTCondor%20and%20Kerberos">4.1. HTCondor and Kerberos</a></li>
<li><a href="#HTCondor%20and%20Environment%20Modules">4.2. HTCondor and Environment Modules</a></li>
</ul>
</li>
<li><a href="#Acknowledging%20HTCondor%20in%20publications">5. Acknowledging HTCondor in publications</a></li>
<li><a href="#Further%20information%20and%20support">6. Further information and support</a></li>
</ul>
</div>
</div>
<div class="mdframed">
<div class="note">
<p>
This documentation, together with example submit files and other material can be
found in the <a href="https://github.com/angel-devicente/htcondor-iac">HTCondor@IAC</a> repository.
</p>

</div>

</div>

<div class="mdframed">
<div class="note">
<p>
Part of the HTCondor infrastructure at the IAC was financed by the Ministry of
Economy and Competitiveness through FEDER funds, code IACA13-3E-2493.
</p>

</div>

</div>

<div id="outline-container-Introduction" class="outline-2">
<h2 id="Introduction"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<div class="mdframed">
<div class="warning">
<p>
If you have no experience with HTCondor, we recommend that you contact us before
running any job so we can give you a quick introduction (bear in mind that you
will be using other users' computers and there are some basic guidelines that
you must follow to avoid disturbing them).
</p>

</div>

</div>
</div>

<div id="outline-container-What%20is%20HTCondor%3F" class="outline-3">
<h3 id="What%20is%20HTCondor%3F"><span class="section-number-3">1.1</span> What is HTCondor?</h3>
<div class="outline-text-3" id="text-1-1">
<p>
At the IAC we have several <a href="http://research.iac.es/sieinvens/SINFIN/Main/supercomputing.php">Supercomputing</a> resources that allow you to obtain
your computational results in much less time and/or work with much more complex
problems. One of them is <a href="http://research.cs.wisc.edu/htcondor/">HTCondor</a>, a High Throughput Computing (<a href="http://en.wikipedia.org/wiki/High-throughput_computing">HTC</a>) system. The
underlying idea is quite simple (and powerful): let's use idle machines to
perform computations while their owners are away. So, in a nutshell, HTCondor is
an application that is installed in our PCs to make it possible to run a large
number of yours and others' computations at a time in different machines when
they are not being used, achieving a better utilization of our resources. A more
detailed overview of HTCondor is available at the <a href="https://htcondor.readthedocs.io/en/latest/overview/index.html">official documentation</a>.
</p>
</div>
</div>

<div id="outline-container-How%20can%20HTCondor%20help%20me%3F" class="outline-3">
<h3 id="How%20can%20HTCondor%20help%20me%3F"><span class="section-number-3">1.2</span> How can HTCondor help me?</h3>
<div class="outline-text-3" id="text-1-2">
<p>
HTCondor is very useful when you have an application that has to run a large
number of times over different input data. For instance, suppose you have a
program that carry out some calculations taking an image file as input. Let's
say that the processing time is about one hour per image and you want to process
250 images. Then you can use your own machine and process all images one by one,
and wait more than 10 days to get all results, or you can use HTCondor to
process each image in different computers and hopefully get all results in one
hour, or maybe two or four, but for sure less than 10 days. And HTCondor will do
all the work for you: it will copy the input files to the remote machines,
execute your program there with different inputs and bring back the results to
your machine when they are complete.
</p>
</div>
</div>

<div id="outline-container-How%20%2Apowerful%2A%20is%20HTCondor%3F" class="outline-3">
<h3 id="How%20%2Apowerful%2A%20is%20HTCondor%3F"><span class="section-number-3">1.3</span> How <b>powerful</b> is HTCondor?</h3>
<div class="outline-text-3" id="text-1-3">
<p>
HTCondor calls a <i>slot</i> the unit that executes a job, typically a CPU or a core
if the CPU has several of them. Right now we have over 1000 slots that might
execute applications submitted via HTCondor. It means that everyday more than
24000 hours could be available to run HTCondor jobs, close to 3 years of
computation in a single day! Obviously, this is the theoretical maximum if no
one were using their computers and all slots were idle, but the number of actual
available slots could be around 400 during office hours and around 700 at nights
and weekends.
</p>

<p>
You can see real-time <b>HTCondor@IAC statistics</b> (global and per user) <a href="http://pasa/ganglia/?r=week&amp;cs=&amp;ce=&amp;m=load_one&amp;tab=v&amp;vn=pool_usage&amp;hide-hf=false">here</a>. Figure
<a href="#orgcf0b6a9">1</a> is an example showing the global usage where <i>Owner</i> represents
<i>slots</i> that are being used outside of HTCondor. The remaining <i>slots</i> are
available to HTCondor, but if there are no eligible jobs to run, those slots
will be in <i>CPUsNotInUse</i> state. Those <i>slots</i> that are actually being used by
HTCondor are those in the <i>CPUsInUse</i> state.
</p>


<div id="orgcf0b6a9" class="figure">
<p><img src="images/introduction/weekly_usage.png" alt="weekly_usage.png" />
</p>
<p><span class="figure-number">Figure 1: </span>Weekly global usage</p>
</div>
</div>
</div>

<div id="outline-container-Which%20machines%20are%20part%20of%20HTCondor%3F" class="outline-3">
<h3 id="Which%20machines%20are%20part%20of%20HTCondor%3F"><span class="section-number-3">1.4</span> Which machines are part of HTCondor?</h3>
<div class="outline-text-3" id="text-1-4">
<p>
HTCondor is installed in a number of <i>burros</i> (High Performance Linux PCs) and
desktop PCs at the IAC Headquarters in La Laguna. 
</p>

<p>
Regarding their hardware specifications, they are rather heterogeneous and their
availability and specifications change from time to time. You can check which
machines make up the HTCondor@IAC pool at any given time in the <a href="http://pasa/ganglia/?r=week&amp;cs=&amp;ce=&amp;c=IAC+HTCondor&amp;h=&amp;tab=m&amp;vn=&amp;hide-hf=false&amp;m=cpu_num&amp;sh=1&amp;z=small&amp;hc=4&amp;host_regex=&amp;max_graphs=0&amp;s=by+name">HTCondor Ganglia
webpage</a>. 
</p>

<p>
Regarding their software specifications, at present all machines are running
Ubuntu 18.04 and the installed software should be also more or less the same in
every machine (see the <a href="http://research.iac.es/sieinvens/SINFIN/Main/software_sinfin.php">software supported by the SIE</a>), which makes it easy to
run almost every application in any machine.
</p>

<p>
Detailed information about each machine can be obtained with the command
<code>condor_status</code> (see Section <a href="#Checking%20pool%20status">3.1</a>). 
</p>

<p>
HTCondor provides a simple mechanism by which you can specify a set of
requirements for the machines where you want your application to run, for
example: memory per slot, OS version, etc. (see Section <a href="#Submit%20files">2</a>).
</p>
</div>
</div>

<div id="outline-container-How%20can%20I%20use%20HTCondor%3F" class="outline-3">
<h3 id="How%20can%20I%20use%20HTCondor%3F"><span class="section-number-3">1.5</span> How can I use HTCondor?</h3>
<div class="outline-text-3" id="text-1-5">
<p>
If you have an account in the IAC network, then you can use HTCondor. 
</p>

<p>
HTCondor is a batch-processing system (i.e. non-interactive), so you submit jobs
to the HTCondor queue with the <code>condor_submit</code> command, and providing a text
submission file, where you specify the executable file, its arguments, inputs
and outputs, etc. (see Section <a href="#Submitting%20jobs">3.2</a>).
</p>

<p>
You do not need to prepare or compile your programs in any special way to run
them, and almost all programming languages should be suitable (shell scripts,
Python, Perl, C, Fortran, IDL, etc.). Sometimes a few minor modifications may be
needed in order to specify arguments and the locations of inputs or outputs.
</p>
</div>
</div>

<div id="outline-container-Where%20will%20my%20application%20run%3F" class="outline-3">
<h3 id="Where%20will%20my%20application%20run%3F"><span class="section-number-3">1.6</span> Where will my application run?</h3>
<div class="outline-text-3" id="text-1-6">
<p>
When you submit jobs to the HTCondor queue, HTCondor uses its allocation
algorithm to send and execute your jobs on those idle slots that satisfy your
requirements. Idle slots are those located in machines where there has been no
keyboard/mouse activity for a long time and the computer load is low enough to
ensure that there is no interference with the owner's processes. 
</p>

<p>
While HTCondor is running its jobs, it also keeps checking that the owner is not
using the machine. If HTCondor detects any activity in the computer (for
instance, keyboard activity), then it will suspend all its jobs and wait a
little while to see whether the machine gets idle again so as to resume the
jobs. If the machine does not become idle in a short time, HTCondor will
<i>vacate</i> it, interrupting all HTCondor jobs and sending them to other available
slots in any other idle machine. 
</p>

<p>
HTCondor will repeat this process untill all jobs are done, optionally sending
notifications via email when they are finished or if any errors show up.
</p>
</div>
</div>

<div id="outline-container-Basic%20HTCondor%20workflow" class="outline-3">
<h3 id="Basic%20HTCondor%20workflow"><span class="section-number-3">1.7</span> Basic HTCondor workflow</h3>
<div class="outline-text-3" id="text-1-7">
<p>
The basic workflow with HTCondor will include four steps: checking the HTCondor
pool status, submitting a job, checking and managing the submitted job, and
getting information from the logs. Commands and examples for these phases are
given with further details in the following sections, but here we present a very
basic example to <b>Quick Start</b> you. 
</p>

<ul class="org-ul">
<li><p>
<b>Checking the HTCondor pool status</b>
</p>

<p>
You can use the command <code>condor_status</code>, to quickly check the status of the
HTCondor pool:
</p>

<div class="mdframed">
<pre class="example">
[angelv@denso ~]$ condor_status -compact
Machine             Platform     Slots Cpus Gpus  TotalGb FreCpu  FreeGb  CpuLoad ST

cruise.dyn.iac.es   x64/Ubuntu18 _        4          7.64      1     1.91    0.00 Oi
dama.ll.iac.es      x64/Ubuntu18 _       40        754.54      1    18.86    0.00 Ui

[...]

villa.dyn.iac.es    x64/Ubuntu18 _       16        187.58      1    11.72    0.00 Oi
virus.dyn.iac.es    x64/Ubuntu18 _        8         62.73      1     7.84    0.02 Oi

               Total Owner Claimed Unclaimed Matched Preempting Backfill  Drain

  x64/Ubuntu18   868   318       2       548       0          0        0      0

         Total   868   318       2       548       0          0        0      0
</pre>

</div></li>

<li><p>
<b>Submitting a job</b>
</p>

<p>
In order to ask HTCondor to run you application you will need:
</p>

<ul class="org-ul">
<li><p>
<b>your application</b>
</p>

<p>
For example, given the following basic C code (<code>simple.c</code>):
</p>

<div class="mdframed">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #b0c4de;">#include</span> <span style="color: #ffa07a;">&lt;stdio.h&gt;</span>

<span style="color: #87cefa;">main</span>(<span style="color: #98fb98;">int</span> <span style="color: #eedd82;">argc</span>, <span style="color: #98fb98;">char</span> **<span style="color: #eedd82;">argv</span>)
{
    <span style="color: #98fb98;">int</span> <span style="color: #eedd82;">sleep_time</span>;
    <span style="color: #98fb98;">int</span> <span style="color: #eedd82;">input</span>;
    <span style="color: #98fb98;">int</span> <span style="color: #eedd82;">failure</span>;

    <span style="color: #00ffff;">if</span> (argc != 3) {
        printf(<span style="color: #ffa07a;">"Usage: simple &lt;sleep-time&gt; &lt;integer&gt;\n"</span>);
        failure = 1;
    } <span style="color: #00ffff;">else</span> {
        sleep_time = atoi(argv[1]);
        input      = atoi(argv[2]);

        printf(<span style="color: #ffa07a;">"Thinking really hard for %d seconds...\n"</span>, sleep_time);
        sleep(sleep_time);
        printf(<span style="color: #ffa07a;">"We calculated: %d\n"</span>, input * 2);
        failure = 0;
    }
    <span style="color: #00ffff;">return</span> failure;
}
</pre>
</div>

</div>

<p>
You would compile it as usual:
</p>

<div class="mdframed">
<div class="org-src-container">
<pre class="src src-bash">gcc -o simple simple.c
</pre>
</div>

</div></li>

<li><p>
<b>a <i>submit file</i></b>
</p>

<p>
The submit file is a plain text file that specifies the name of your
executable (<code>simple</code>), how many jobs to submit (<code>Queue 100</code>), etc.
</p>

<div class="mdframed">
<pre class="example">
Executable = simple
Arguments  = 400 10
Log        = simple.log
Output     = simple.$(Process).out
Error      = simple.$(Process).error

Queue 100
</pre>

</div></li>

<li><p>
<b>the <code>condor_submit</code> command</b>
</p>

<p>
Using the <i>submit file</i> as an argument to the command <code>condor_submit</code> you
instruct HTCondor to start executing your job in the HTCondor Pool.
</p>

<div class="mdframed">
<pre class="example">
[angelv@denso ~]$ condor_submit test.condor
Submitting job(s)...........................................................
100 job(s) submitted to cluster 4.
</pre>

</div></li>
</ul></li>

<li><p>
<b>Checking the progress of the submitted jobs</b>
</p>

<p>
The basic command to check on the progress of your jobs is <code>condor_q</code>. In the
following example we can see that all the 100 jobs submitted above are successfully
running:
</p>

<div class="mdframed">
<pre class="example">
[angelv@denso ~]$ condor_q

-- Schedd: denso.ll.iac.es : &lt;161.72.216.13:9618?... @ 02/27/23 09:27:40
OWNER  BATCH_NAME    SUBMITTED   DONE   RUN    IDLE  TOTAL JOB_IDS
angelv ID: 4        2/27 09:24      _    100      _    100 4.0-99

Total for query: 100 jobs; 0 completed, 0 removed, 0 idle, 100 running, 0 held, 0 suspended 
Total for angelv: 100 jobs; 0 completed, 0 removed, 0 idle, 100 running, 0 held, 0 suspended 
Total for all users: 100 jobs; 0 completed, 0 removed, 0 idle, 100 running, 0 held, 0 suspended
</pre>

</div></li>

<li><p>
<b>Getting information from the logs</b>
</p>

<p>
If everything goes well, when the jobs finish, any output files created by
your application will be, by default, copied back to the directory whence you
submitted your job. 
</p>

<p>
At the same time, you can instruct HTCondor to save to files any output that
your application produces. In the example above, the <i>standard output</i>
generated by each job is written to a file called <code>simple.$(Process).out</code>,
where <code>$(Process)</code> will be automatically substituted by HTCondor by the number
of each job (in this case, given that we submitted 100 jobs, the numbers will
go from 0 to 99). For example, the file <code>simple.0.out</code> could read:
</p>

<div class="mdframed">
<pre class="example">
[angelv@denso ~]$ cat simple.0.out 
Thinking really hard for 400 seconds...
We calculated: 20
</pre>

</div>

<p>
Also, a global log of the steps taken by HTCondor to execute your jobs can
generated (in the example above called <code>simple.log</code>). This log will give you
details of when each job was submitted, when it started executing, whether it
was evicted or had any other problems, etc. In this example, the file
<code>simple.log</code> could read: 
</p>

<div class="mdframed">
<pre class="example">
[angelv@denso ~]$ cat simple.log 
000 (004.000.000) 2023-02-27 09:24:41 Job submitted from host: &lt;161.72.216.13:9618?addrs=161.72.216.13-9618+[2001-720-1610-50d8--d]-9618&amp;alias=denso.ll.iac.es&amp;noUDP&amp;sock=schedd_3008_d0f7&gt;
...
000 (004.001.000) 2023-02-27 09:24:41 Job submitted from host: &lt;161.72.216.13:9618?addrs=161.72.216.13-9618+[2001-720-1610-50d8--d]-9618&amp;alias=denso.ll.iac.es&amp;noUDP&amp;sock=schedd_3008_d0f7&gt;
...
000 (004.002.000) 2023-02-27 09:24:41 Job submitted from host: &lt;161.72.216.13:9618?addrs=161.72.216.13-9618+[2001-720-1610-50d8--d]-9618&amp;alias=denso.ll.iac.es&amp;noUDP&amp;sock=schedd_3008_d0f7&gt;

[...]

040 (004.002.000) 2023-02-27 09:24:47 Started transferring input files
        Transferring to host: &lt;161.72.216.8:9618?addrs=161.72.216.8-9618+[2001-720-1610-50d8-21e-4fff-feba-8ff9]-9618&amp;alias=delta.ll.iac.es&amp;noUDP&amp;sock=slot4_3147_1899_416&gt;
...
040 (004.003.000) 2023-02-27 09:24:47 Started transferring input files
        Transferring to host: &lt;161.72.216.8:9618?addrs=161.72.216.8-9618+[2001-720-1610-50d8-21e-4fff-feba-8ff9]-9618&amp;alias=delta.ll.iac.es&amp;noUDP&amp;sock=slot5_3147_1899_414&gt;

[...]

001 (004.002.000) 2023-02-27 09:24:48 Job executing on host: &lt;161.72.216.8:9618?addrs=161.72.216.8-9618+[2001-720-1610-50d8-21e-4fff-feba-8ff9]-9618&amp;alias=delta.ll.iac.es&amp;noUDP&amp;sock=startd_2745_6b8f&gt;
...
001 (004.003.000) 2023-02-27 09:24:48 Job executing on host: &lt;161.72.216.8:9618?addrs=161.72.216.8-9618+[2001-720-1610-50d8-21e-4fff-feba-8ff9]-9618&amp;alias=delta.ll.iac.es&amp;noUDP&amp;sock=startd_2745_6b8f&gt;

[...]

005 (004.040.000) 2023-02-27 09:31:45 Job terminated.
        (1) Normal termination (return value 0)
                Usr 0 00:00:00, Sys 0 00:00:00  -  Run Remote Usage
                Usr 0 00:00:00, Sys 0 00:00:00  -  Run Local Usage
                Usr 0 00:00:00, Sys 0 00:00:00  -  Total Remote Usage
                Usr 0 00:00:00, Sys 0 00:00:00  -  Total Local Usage
        58  -  Run Bytes Sent By Job
        8432  -  Run Bytes Received By Job
        58  -  Total Bytes Sent By Job
        8432  -  Total Bytes Received By Job
        Partitionable Resources :    Usage  Request Allocated
           Cpus                 :        0        1         1
           Disk (KB)            :       24       10 207282725
           Memory (MB)          :        0        1      4024

        Job terminated of its own accord at 2023-02-27T09:31:44Z with exit-code 0.
</pre>

</div></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-Submit%20files" class="outline-2">
<h2 id="Submit%20files"><span class="section-number-2">2</span> Submit files</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-Submit%20files--Introduction" class="outline-3">
<h3 id="Submit%20files--Introduction"><span class="section-number-3">2.1</span> Introduction</h3>
<div class="outline-text-3" id="text-2-1">
<p>
<i>HTCondor Submit Description Files</i>, or simply <i>Submit files</i>, are arguably the
cornerstone of your interaction with HTCondor, since you use them to specify how
to execute your application with HTCondor, by providing a number of parameters
like the name of your executable, its arguments, inputs and outputs,
requirements, etc. 
</p>

<p>
In section <a href="#Basic%20HTCondor%20workflow">1.7</a> we saw a very simple <i>submit
file</i>. Depending on your needs, that might be enough, but HTCondor offers many
options and a rich syntax for writing <i>submit files</i>, which will be useful in
more advanced cases. In this section we will cover the features needed in some
of the most typical scenarios.
</p>

<div class="mdframed">
<div class="warning">
<p>
Before submitting your jobs, perform always some simple tests in order to make
sure that both your submit file and program will work in a proper way. Also,
<code>condor_submit -dry-run</code> can help you to debug your jobs and make sure they will
work as expected.
</p>

</div>

</div>
</div>
</div>

<div id="outline-container-%2FSubmit%20files%2F%20syntax" class="outline-3">
<h3 id="%2FSubmit%20files%2F%20syntax"><span class="section-number-3">2.2</span> <i>Submit files</i> syntax</h3>
<div class="outline-text-3" id="text-2-2">
<p>
HTCondor <i>submit files</i> can include comments, variables, macros, commands,
etc. Here we will describe the most important syntax components. For a more
detailed description you can check the official documentation (<a href="https://htcondor.readthedocs.io/en/latest/users-manual/submitting-a-job.html">Submitting a Job</a>,
<a href="https://htcondor.readthedocs.io/en/latest/man-pages/condor_submit.html"><code>condor_submit</code></a>).
</p>
</div>

<div id="outline-container-Comments" class="outline-4">
<h4 id="Comments"><span class="section-number-4">2.2.1</span> Comments</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
Blank lines and lines beginning with a pound sign (<code>#</code>) character are ignored by
the submit description file parser.
</p>
</div>
</div>

<div id="outline-container-Variables%20and%20macros" class="outline-4">
<h4 id="Variables%20and%20macros"><span class="section-number-4">2.2.2</span> Variables and macros</h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
You can define your own variables, and there are also many predefined variables
and macros that you can use in <i>submit files</i>.
</p>

<ul class="org-ul">
<li>To <b>define a variable</b>, just choose a valid name (names are case-insensitive)
and assign a value to it, like <code>N = 4</code>, <code>Name = "example"</code></li>
<li>To <b>get the value</b> of a variable, use next syntax: <code>$(varName)</code> (both the <code>$</code>
symbol and the parentheses <code>()</code> are mandatory).</li>
<li>There are several special <b>automatic variables</b> defined. The most useful one
is <code>*$(Process)*</code> or <code>$(ProcId)</code>, that will contain the Process ID of each job
(if you submit <code>N</code> jobs, the value of <code>$(Process)</code> will be <code>0</code> for the first
job and <code>N-1</code> in the last job). This variable is like an <b>iteration counter</b>
and you can use it to specify different inputs, outputs, arguments, etc. for
each job. There are some <b>other automatic variables</b>, like <code>$(Cluster)</code> or
<code>$(ClusterId)</code> that stores the ID of each submission, <code>$(Item)</code>,
<code>$(ItemIndex)</code>, <code>$(Step)</code>, <code>$(Row)</code>, etc.</li>
<li>There are several <b>pre-defined Function Macros</b>. Their syntax is
<code>$FunctName(varName)</code> and they can perform some operations on variable
<code>varName</code> like evaluating expressions and type conversions, selecting a value
from a list according an index, getting random numbers, string operations,
filenames processing, setting environment variables, etc.</li>
<li>You can do <b>basic operations</b> with variables, like <code>B = $(A) + 1</code>, etc. To get
the expression evaluated, you may need to use function macros like <code>$INT(B)</code>,
<code>$REAL(B)</code>, etc.</li>
</ul>
</div>
</div>

<div id="outline-container-Submit%20commands" class="outline-4">
<h4 id="Submit%20commands"><span class="section-number-4">2.2.3</span> Submit commands</h4>
<div class="outline-text-4" id="text-2-2-3">
<p>
The commands which can appear in the submit description file are numerous (see
<a href="https://htcondor.readthedocs.io/en/latest/man-pages/condor_submit.html#submit-description-file-commands">submit description file commands</a>), but in most situations you will only need a
few of them. Here we present the most common ones (<i>commands are
case-insensitive</i>): 
</p>

<ul class="org-ul">
<li><b>Mandatory commands</b>
<ul class="org-ul">
<li><b><code>executable</code></b> location of the executable file (you can use an
absolute path, one relative to the directory where you do the submission or
to another directory specified with <code>initialdir</code>). You should specify <b>only
the executable</b> and not other things like arguments, etc., since there are
specific commands for that.</li>
<li><b><code>queue</code></b> this command will send your job(s) to the queue, so it should be
the last command in your submit file. With it you can specify the number of
jobs to submit, but you can also use it to specify variables, iterations
over other commands, files to be processed, list of arguments, etc.</li>
</ul></li>

<li><b>Highly recommended commands</b>
<ul class="org-ul">
<li><b><code>output</code></b> it will copy the standard output printed on the screen
(<code>stdout</code>) of the remote machines when executing your program to the local
file you specify here. In order to generate a different output file for each
job, the filename should include variables, like <code>$(Process)</code> (and perhaps
also <code>$(Cluster)</code>.</li>
<li><b><code>error</code></b> the same as previous command, but for standard error output
(<code>stderr</code>).</li>
<li><b><code>log</code></b> file to keep track of the progress of your submission (very useful
to debug problems with your job(s). It is advisable to keep just one log
file for all jobs belonging to the same submission, so a filename with a
name like <code>log.$(Cluster)</code> is recommended.</li>
<li><b><code>universe</code></b> your job(s) <b>execution environment</b>. By default, the simplest
one (<code>vanilla</code>) will be chosen, but for more advanced users, other
<code>universe</code> might be necessarey. See <a href="https://htcondor.readthedocs.io/en/latest/users-manual/choosing-an-htcondor-universe.html">Choosing an HTCondor Universe</a>.</li>
</ul></li>

<li><b>Useful commands for application Input/Output</b>
<ul class="org-ul">
<li><b><code>arguments</code></b> used to specify options and flags for your executable
file (as if it executed in the command line).</li>
<li><b><code>should_transfer_files</code></b> assign <code>YES</code> in order to activate HTCondor's file
transfer system (needed when working with files).</li>
<li><b><code>transfer_input_files</code></b> a comma-separated list of files (with absolute or
relative paths) used to specify
where the needed input files are located. HTCondor will copy all the files
(together with the executable) to the root directory of a virtual
location on the remote machine. A directory name with a trailing <b><code>/</code></b>
character will copy only the contents of the directory. Without the trailing
<b><code>/</code></b> the directory itself and its contents will be copied.</li>
<li><b><code>transfer_output_files</code></b> a comma-separated list of result files to be
copied back to our machine. If this command is omitted, HTCondor will
automatically copy all files that have been created or modified on the
remote machine. Sometimes omitting this command is useful, but other times
our program creates many temporary or useless files and we only want to get
the ones we specify with this command.</li>
<li>Other commands for input/output files:
<ul class="org-ul">
<li><b><code>transfer_output_remaps</code></b> it changes the name of the output files when
copying them to your machine (useful when output files have the same name,
so including a variable part, e.g. <code>$(Process)</code>, will avoid overwritten
them).</li>
<li><b><code>initialdir</code></b> used to specify the base directory for input and output
files (if it includes a variable part (like <code>$(Process)</code>), a different
base directory can be used for each job).</li>
<li><b><code>input</code></b> if your program needs some data from keyboard, you can write it
down in a file (as when using <code>stdin</code> redirection in the command line with
<b><code>&lt;</code></b>).</li>
<li><b><code>transfer_executable</code></b> by default <code>True</code>. Useful to set it to <code>False</code>
when the executable is a system command or a program that is installed in
all machines, so copying it is not needed.</li>
</ul></li>
</ul></li>

<li><b>Other useful commands</b>
<ul class="org-ul">
<li><b><code>request_memory</code></b>, <b><code>request_disk</code></b> to request machines with at least a
certain amount of total RAM memory or fee disk space</li>
<li><b><code>requirements</code></b> a very useful command to register any special needs for a
job (for example, if you need to avoid certain machines, or you need
machines with a given OS, etc.)</li>
<li><b><code>rank</code></b> you can specify some values or combination of them (total memory,
free disk space, MIPS, etc.) and HTCondor will choose the best machines for
your jobs according to your specifications, where the higher the value, the
better (this command is used to specify preferences, not requirements)</li>
<li><b><code>getenv</code></b> (<i>default</i>: <code>False</code>) if set to <code>True</code>, the job will run with the
same environment variables as when the job was submitted. If <code>False</code> the
jobs will have no preset environment variables.</li>
<li><b><code>environment</code></b> list of environment variables to set for the job</li>
<li><b><code>nice_user</code></b> (<i>default</i>: <code>False</code>) if set to <code>True</code> the jobs will be
executed with very low priority.</li>
<li><b><code>priority</code></b> assign a priority for your jobs (the higher the value, the
higher the priority).</li>
<li><b><code>concurrency_limits</code></b> to limit the maximum number of your jobs that
could be executed at the same time (for example if the program needs a
licence and only a limited number of them is available).</li>
<li><b><code>include : &lt;myfile&gt;</code></b> to include commands from an external file. It is also
possible to include the output of external scripts that will be executed at
submission time, adding a pipe symbol after the file: <b>=include : &lt;myscript.sh&gt; | =</b></li>
<li><b><code>+PreCmd</code>, <code>+PreArguments</code>, <code>+PostCmd</code>, <code>+PostArguments</code></b> commands to
specify scripts to run before and/or after your executable (to convert,
decompress, etc. your inputs and outputs if needed, or for debugging)</li>
<li><b><code>notify_user</code>, <code>notification</code></b> commands to request a notification (an
email) when your jobs begin, fail and/or finish</li>
</ul></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-Examples" class="outline-3">
<h3 id="Examples"><span class="section-number-3">2.3</span> Examples</h3>
<div class="outline-text-3" id="text-2-3">
<div class="mdframed">
<div class="note">
<p>
All the submit files in this section can be found in the <code>examples</code> directory of
the <a href="https://github.com/angel-devicente/htcondor-iac">HTCondor@IAC</a> repository. 
</p>

</div>

</div>
</div>

<div id="outline-container-HTCondor%20%2FHello%20World%21%2F" class="outline-4">
<h4 id="HTCondor%20%2FHello%20World%21%2F"><span class="section-number-4">2.3.1</span> HTCondor <i>Hello World!</i></h4>
<div class="outline-text-4" id="text-2-3-1">
<p>
This example (directory <code>hello_world</code>) was the basis for the introductory
section <a href="#Basic%20HTCondor%20workflow">1.7</a>. The commands used were already introduced in
section <a href="#Submit%20commands">2.2.3</a>. For convenience we repeat below the <i>submit file</i>
(<code>simple.submit</code>):
</p>

<div class="mdframed">
<pre class="example">
Executable = simple
Arguments  = 400 10
Log        = simple.log
Output     = simple.$(Process).out
Error      = simple.$(Process).error

Queue 100
</pre>

</div>

<p>
This example simply defines:
</p>
<ul class="org-ul">
<li>the executable to run (<code>simple</code>), here to be compiled from source code
<code>simple.c</code></li>
<li>the arguments to pass to the executable</li>
<li>the log file (one file for the log of the 100 submitted jobs)</li>
<li>the output files (since we use <code>$(Process)</code>, one file will be used for each job:
<code>simple.0.out</code>, <code>simple.1.out</code>, etc.)</li>
<li>the error files (similar to the output files above)</li>
<li>the <code>Queue</code> command, specifying that we want to run 100 jobs (the variable
<code>$(Process)</code> will have the range [0:99]</li>
</ul>
</div>
</div>

<div id="outline-container-Similar%20jobs%20with%20one%20%3DQueue%3D%20command" class="outline-4">
<h4 id="Similar%20jobs%20with%20one%20%3DQueue%3D%20command"><span class="section-number-4">2.3.2</span> Similar jobs with one <code>Queue</code> command</h4>
<div class="outline-text-4" id="text-2-3-2">
<p>
The example in the previous section <a href="#HTCondor%20%2FHello%20World%21%2F">2.3.1</a> used the variable
<code>$(Process)</code> to identify the different jobs in a single run. Sometimes this is
enough, but not always. Say you have 100 images to process and your executable
takes the filename of the image as an argument. If you were going to use the
same method as above, you would need to rename your files to something like
<code>image00.jpg</code>, <code>image01.jpg</code>, etc. or some other similar idea, in order to
relate each image with each of the possible values of <code>$(Process)</code>. 
</p>

<p>
Luckily, the <code>queue</code> command has a powerful syntax that makes this
unnecessary. Here we only present one example, but in the official HTCondor
documentation you can check the <a href="https://htcondor.readthedocs.io/en/latest/users-manual/submitting-a-job.html#submitting-many-similar-jobs-with-one-queue-command">full syntax and further examples</a>. 
</p>

<p>
This example (directory <code>queue_similar</code>) shows how to use <code>queue [...] matching</code>
command to process a number of files having the extension <code>.txt</code>, without the
need to rename the filenames, and without the need to specify the exact number
of jobs to submit. The <i>submit file</i> (<code>simple.submit</code>) is very simple:
</p>

<div class="mdframed">
<pre class="example">
Executable = process.sh
Arguments  = $(txtfile)
Log        = queue.log
Output     = queue.$(txtfile).out
Error      = queue.$(txtfile).error

transfer_input_files = $(txtfile)

queue txtfile matching files *.txt
</pre>

</div>
</div>
</div>
</div>
</div>


<div id="outline-container-Main%20HTCondor%20commands" class="outline-2">
<h2 id="Main%20HTCondor%20commands"><span class="section-number-2">3</span> Main HTCondor commands</h2>
<div class="outline-text-2" id="text-3">
<p>
HTCondor provides around 100 commands (see the <a href="https://htcondor.readthedocs.io/en/latest/man-pages/index.html">Command Reference Manual)</a>, but
you will only need a few of them for most of you work with HTCondor. In this
section we introduce the most common ones, grouped according to the four common
tasks introduced in section <a href="#Basic%20HTCondor%20workflow">1.7</a>: Checking pool status
(<a href="#Checking%20pool%20status">3.1</a>), Submitting jobs (<a href="#Submitting%20jobs">3.2</a>), Checking and
managing submitted jobs (<a href="#Checking%20and%20managing%20submitted%20jobs">3.3</a>) and Getting info
from logs (<a href="#Getting%20information%20from%20the%20logs">3.4</a>). For each command we also give a
list of some of their most useful options (but note that you can also get full
details about each command by executing <code>man condor_&lt;cmd&gt;</code> in your shell).
</p>
</div>

<div id="outline-container-Checking%20pool%20status" class="outline-3">
<h3 id="Checking%20pool%20status"><span class="section-number-3">3.1</span> Checking pool status</h3>
<div class="outline-text-3" id="text-3-1">
<ul class="org-ul">
<li><b><code>condor_status</code></b> List slots in the HTCondor pool and their status: <code>Owner</code> (used
by owner), <code>Claimed</code> (used by HTCondor), <code>Unclaimed</code> (available to be used
by HTCondor), etc. 
<ul class="org-ul">
<li><b><code>-avail</code></b> List those slots that are not busy and could run HTCondor jobs at
this moment</li>
<li><b><code>-submitters</code></b> Show information about the current general status, like
number of running, idle and held jobs (and submitters)</li>
<li><b><code>-run</code></b> List slots that are currently running jobs and show related
information (owner of each job, machine where it was submitted from, etc.)</li>
<li><b><code>-compact</code></b> Compact list, with one line per machine instead of per slot</li>
<li><b><code>-state -total</code></b> List a summary according to the state of each slot</li>
<li><b><code>-master</code></b> List machines, but just their names (status and slots are not
shown)</li>
<li><b><code>-server</code></b> List attributes of slots, such as memory, disk, load, flops, etc.</li>
<li><b><code>-sort Memory</code></b> Sort slots by Memory, you can try also with other attributes</li>
<li><b><code>-af &lt;attr1&gt; &lt;attr2&gt; &lt;...&gt;</code></b> List specific attributes of slots, using
autoformat (new version, very powerful)</li>
<li><b><code>-format &lt;fmt&gt; &lt;attr&gt;</code></b> List attributes using the specified format (old
version). For instance, next command will show the name of each slot and the
disk space: <code>condor_status -format "%s\t " Name -format "%d KB\n" Disk</code></li>
<li><b><code>&lt;machine&gt;</code></b> Show the status of a specific machine</li>
<li><b><code>&lt;machine&gt; -long</code></b> Show the complete "ClassAd" of a machine (its
specifications). We can use these specifications to add restrictions in the
submit file so we can control which machines we want to use.</li>
<li><b><code>-constraint &lt;constraint&gt;</code></b> Only Show slots that satisfy the
constraint. I.e: <code>condor_status -constraint 'Memory &gt; 1536'</code> will only show
slots with more than 1.5GB of RAM per slot.</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-Submitting%20jobs" class="outline-3">
<h3 id="Submitting%20jobs"><span class="section-number-3">3.2</span> Submitting jobs</h3>
<div class="outline-text-3" id="text-3-2">
<div class="warning">
<p>
Before submitting your jobs, always do some simple tests in order to make sure
that both your submit file and program work in a proper way: if you are going to
submit hundreds of jobs and each job takes several hours to finish, before doing
that try with just a few jobs and change the input data in order to let them
finish in minutes. Then check the results to see if everything went fine before
submitting the real jobs. Bear in mind that submitting untested files and/or
jobs may cause a waste of time and resources if they fail, and also your
priority will be lower in following submissions.
</p>

</div>

<ul class="org-ul">
<li><b><code>condor_submit &lt;submit_file&gt;</code></b> Submit jobs to the HTCondor queue according to
the information specified in <code>submit_file</code>. Visit the <b>submit file page</b> to
see some examples of these files. There are also some FAQs related to the
submit file. 
<ul class="org-ul">
<li><b><code>-dry-run &lt;dest_file&gt;</code></b> this option parses the submit file and saves all
the related info (name and locations of input and output files after
expanding all variables, value of requirements, etc.) to <code>&lt;dest_file&gt;</code>, but
jobs are <b>not</b> submitted. Using this option is highly recommended when
debugging or before the actual submission if you have made some
modifications in your submit file and you are not sure whether they will
work.</li>
<li><b><code>'var=value'</code></b> add or modify variable(s) at submission time, without
changing the submit file. For instance, if you are using <code>queue $(N)</code> in
your submit file, then <code>condor_submit &lt;submit_file&gt; 'N = 10'</code> will submit 10
jobs. You can specify several pairs of <code>var=value</code>.</li>
<li><b><code>-append &lt;command&gt;</code></b> add submit commands at submission time, without
changing the submit file. You can add more than one command using several
times <code>-append</code>.</li>
</ul></li>
</ul>

<p>
When submitted, each job is identified by a pair of numbers <b>X.Y</b>, like
345.32. The first number (<b>X</b>) is the <b>cluster id</b>: every submission gets a
different cluster id, that is shared by all jobs belonging to the same
submission. The second number (<b>Y</b>) is the <b>process id</b>: if you submitted N
jobs, then this id will go from 0 for the first job to N-1 for the last one. For
instance, if you submit a file specifying 4 jobs and HTCondor assign id 523 to
that cluster, then the ids of your jobs will be 523.0, 523.1, 523.2 and 523.3
(you can get these ids and more info using <code>condor_q</code> command).
</p>
</div>
</div>

<div id="outline-container-Checking%20and%20managing%20submitted%20jobs" class="outline-3">
<h3 id="Checking%20and%20managing%20submitted%20jobs"><span class="section-number-3">3.3</span> Checking and managing submitted jobs</h3>
<div class="outline-text-3" id="text-3-3">
<div class="mdframed">
<div class="note">
<p>
Each machine manages its own HTCondor queue, so it has information only about
those jobs that were submitted on it (and no information about any other jobs
you may have submitted on other machines). Most of the commands explained in
this section get information asking only the local queue, which means that you
will only see those jobs that you have submitted on that specific machine. If
you submit jobs from different machines, and later you want to check, hold,
release, remove, etc. those jobs, you may need to connect to each one of those
machines where you have submitted jobs from, or, when possible, use the commands
with extra options to communicate with other machines.
</p>

</div>

</div>

<ul class="org-ul">
<li><p>
<b><code>condor_q</code></b> Show my jobs that have been submitted in this machine. By default
you will see the ID of the job(<code>clusterID.processID</code>), the owner, submitting
time, run time, status, priority, size and command. <b>STATUS</b> can be: <b>I</b>:idle
(waiting for a machine to execute on); <b>R</b>: running; <b>H</b>: on hold (there was
an error, waiting for user's action); <b>S</b>: suspended; <b>C</b>: completed; <b>X</b>:
removed; <b>&lt;</b>: transferring input; and <b>&gt;</b>: transferring output. 
</p>

<div class="mdframed">
<div class="note">
<p>
HTCondor will, by default, show only your jobs. If you want to use all
users' submitted jobs, you can use the option <b><code>-allusers</code></b>
</p>

</div>

</div>

<ul class="org-ul">
<li><b><code>-global</code></b> Show my jobs submitted in any machine, not only the current one</li>
<li><b><code>-nobatch</code></b> Starting in version HTCondor 8.6.0 installed in January 2017,
data is displayed in a compact mode (one line per cluster). With this option
output will be displayed in the old format (one line per process)</li>
<li><b><code>-wide</code></b> Do not truncate long lines. You can also use <code>-wide:&lt;n&gt;</code> to
truncate lines to fit <code>n</code> columns</li>
<li><b><code>-analyze &lt;job_id&gt;</code></b> Analyse a specific job and show the reason why it is in
its current state (useful for those jobs in Idle status: Condor will show us
how many slots match our restrictions and may give us suggestion)</li>
<li><b><code>-better-analyze &lt;job_id&gt;</code></b> Analyse a specific job and show the reason why
it is in its current state, giving extended info</li>
<li><b><code>-long &lt;job_id&gt;</code></b> Show all information related to that job</li>
<li><b><code>-run</code></b> Show your running jobs and related info, like how much time they
have been running, in which machine, etc.</li>
<li><b><code>-currentrun</code></b> Show the consumed time on the current run, the cumulative
time from last executions will not be used (you can combine also with <code>-run</code>
flag to see only the running processes at the moment)</li>
<li><b><code>-hold</code></b> Show only jobs in the "on hold" state and the reason for that. Held
jobs are those that got an error so they could not finish. An action from
the user is expected to solve the problem, and then he should use the
<code>condor_release</code> command in order to check the job again</li>
<li><b><code>-af &lt;attr1&gt; &lt;attr2&gt; &lt;...&gt;</code></b> List specific attributes of jobs, using
autoformat</li>
<li><b><code>-global -submitter &lt;user&gt;</code></b> Show all jobs from user <code>&lt;user&gt;</code> in all
machines.</li>
</ul></li>

<li><b><code>condor_tail &lt;job_id&gt;</code></b> Display on screen the last lines of the <code>stdout</code>
(screen) of a running job on a remote machine. You can use this command to
check whether your job is working fine, you can also visualize errors
(<code>stderr</code>) or output files created by your program. 
<ul class="org-ul">
<li><b><code>-f</code></b> Do not stop displaying the content, it will be displayed until
interrupted with <code>Ctrl+C</code></li>
<li><b><code>-no-stdout -stderr</code></b> Show the content of <code>stderr</code> instead of <code>stdout</code></li>
<li><b><code>-no-stdout &lt;output_file&gt;</code></b> Show the content of an output file (<code>output_file</code>
has to be listed in the <code>transfer_output_files</code> command in the submit file).</li>
</ul></li>

<li><p>
<b><code>condor_release &lt;option&gt;</code></b> Release jobs held in the queue
</p>
<ul class="org-ul">
<li><b><code>&lt;job_id&gt;</code></b> Release a specific held job</li>
<li><b><code>&lt;cluster_id&gt;</code></b> Release all held jobs of a specific submission</li>
<li><b><code>-constraint &lt;constraint&gt;</code></b> Release all my held jobs that satisfy the
constraint</li>
<li><b><code>-all</code></b> Release all my held jobs</li>
</ul>

<div class="mdframed">
<div class="note">
<p>
Jobs with <i>on hold</i> state are those that HTCondor was not able
to properly execute, usually due to problems with executable, paths, etc. If
you can solve the problems changing the input files and/or the executable,
then you can use the <code>condor_release</code> command to run again your program since it
will send again all files to the remote machines. If you need to change the
submit file to solve the problems, then <code>condor_release</code> will <b>not</b> work because
it will not evaluate again the submit file. In that case you can use
<code>condor_qedit</code> or cancel all held jobs and re-submit them again.
</p>

</div>

</div></li>

<li><b><code>condor_hold &lt;option&gt;</code></b> Put jobs into the hold state. 
Holding jobs can be useful when you detect that there are some problems with
your input data, you are running out of disk space for outputs, etc. With this
command you can delay the execution of your jobs and, after solving the
problems, <i>release</i> them with the command <code>condor_release</code>, so they will be
executed again. 
<ul class="org-ul">
<li><b><code>&lt;job_id&gt;</code></b> Put a specific job in the hold state.</li>
<li><b><code>&lt;cluster_id&gt;</code></b> Hold all the jobs of a specific submission</li>
<li><b><code>-constraint &lt;constraint&gt;</code></b> Hold all jobs that satisfy the constraint</li>
<li><b><code>-all</code></b> Hold all my jobs from the queue</li>
</ul></li>

<li><b><code>condor_rm &lt;option&gt;</code></b> Remove jobs from the queue
Jobs will be removed from the queue even it they are running. But note that
only jobs submitted from the current machine will be removed, so if you
submitted jobs from different machines, you need to remove your jobs from each
of them. 
<ul class="org-ul">
<li><b><code>&lt;job_id&gt;</code></b> Remove a specific job from the queue</li>
<li><b><code>&lt;cluster_id&gt;</code></b> Remove all jobs of a specific submission</li>
<li><b><code>-constraint &lt;constraint&gt;</code></b> Remove all jobs that satisfy the constraint</li>
<li><b><code>-all</code></b> Remove all my jobs from the queue</li>
<li><b><code>-forcex &lt;job_id&gt;</code></b> It could happen that after removing jobs, they don't
disappear from the queue as expected, but they just change status to
<b>X</b>. That's normal since HTCondor may need to do some extra operations. If
jobs stay with 'X' status a very long time, you can force their elimination
adding <code>-forcex</code> option. For instance: <code>condor_rm -forcex -all</code>.</li>
</ul></li>

<li><b><code>condor_prio</code></b> Set the priority of my jobs. A user can only change the
priority of her own jobs, to specify which ones she would like to run first
(the higher the number, the bigger the priority). Priority could be absolute
or relative, use <code>man condor_prio</code> for further information.</li>

<li><b><code>condor_ssh_to_job &lt;job_id&gt;</code></b> Create an ssh session to a running job in a
remote machine. You can use this command to check whether the execution is
going fine, download/upload inputs or outputs, etc.</li>
</ul>
</div>
</div>

<div id="outline-container-Getting%20information%20from%20the%20logs" class="outline-3">
<h3 id="Getting%20information%20from%20the%20logs"><span class="section-number-3">3.4</span> Getting information from the logs</h3>
<div class="outline-text-3" id="text-3-4">
<ul class="org-ul">
<li><b><code>condor_userlog &lt;log file&gt;</code></b> Show and summarize job statistics from the job
log files (those created when using <code>log</code> command in the submit file)</li>

<li><b><code>condor_history</code></b> Show all completed jobs to date (only jobs that were
submitted to the machine where you run this command).
<ul class="org-ul">
<li><b><code>-userlog &lt;log file&gt;</code></b> list basic information registered in the log files</li>
<li><b><code>-long XXX.YYY -af LastRemoteHost</code></b> show machine where job XXX.YYY was
executed</li>
<li><p>
<b><code>-constraint &lt;constraint&gt;</code></b> Only show jobs that satisfy the constraint, for
example to show the jobs that were removed before completion:
</p>

<pre class="example">
condor_history -constraint 'RemoveReason=!=UNDEFINED'
</pre></li>
</ul></li>

<li><p>
There is also a useful online tool to analyze your log files and get more
information: <code>HTCondor Log Analyzer</code> (<a href="http://condorlog.cse.nd.edu/">http://condorlog.cse.nd.edu/</a>). Figure
<a href="#org0d3d80b">2</a> shows an example of the output generated.
</p>


<div id="org0d3d80b" class="figure">
<p><img src="images/commands/condor_log_analyzer.png" alt="condor_log_analyzer.png" />
</p>
<p><span class="figure-number">Figure 2: </span>Condor Log Analyzer sample output</p>
</div></li>
</ul>
</div>
</div>


<div id="outline-container-Other%20commands" class="outline-3">
<h3 id="Other%20commands"><span class="section-number-3">3.5</span> Other commands</h3>
<div class="outline-text-3" id="text-3-5">
<ul class="org-ul">
<li><b><code>condor_userprio</code></b> Show active HTCondor users' priority. Lower values means
higher priority where 0.5 is the highest. Use <code>condor_userprio -allusers</code> to
see all users' priority, and you can also add flags <code>-priority</code> and/or
<code>-usage</code> to get some extra information</li>
<li><b><code>condor_qedit</code></b> use this command to modify the attributes of a job placed on
the queue. This may be useful when you need to change some of the parameters
specified in the submit file without re-submitting jobs.</li>
<li><b><code>condor_submit_dag &lt;dag_file&gt;</code></b> Submit a DAG file, used to describe jobs
with dependencies. See the section on <a href="https://htcondor.readthedocs.io/en/latest/users-manual/dagman-workflows.html">DAGMan Workflows</a> for more information.</li>
<li><b><code>condor_version</code></b> Print the version of HTCondor.</li>
<li>If you want some general information about the HTCondor Pool, where jobs have
been executed on, etc., as mentioned in section <a href="#How%20%2Apowerful%2A%20is%20HTCondor%3F">1.3</a>,
you can check real-time <b>HTCondor@IAC statistics</b> (global and per user) <a href="http://pasa/ganglia/?r=week&amp;cs=&amp;ce=&amp;m=load_one&amp;tab=v&amp;vn=pool_usage&amp;hide-hf=false">here</a>.</li>
</ul>
</div>
</div>


<div id="outline-container-HTCondor%20from%20Python" class="outline-3">
<h3 id="HTCondor%20from%20Python"><span class="section-number-3">3.6</span> HTCondor from Python</h3>
<div class="outline-text-3" id="text-3-6">
<p>
HTCondor comes with <a href="https://htcondor.readthedocs.io/en/latest/apis/python-bindings/tutorials/index.html">Python Bindings</a>, which provide a powerful mechanism to
interact with HTCondor from a Python program.
</p>

<p>
Most users are probably just interested on how to use these bindings to submit
and manage jobs all from within Python. A nice tutorial for this can be found
<a href="https://htcondor.readthedocs.io/en/latest/apis/python-bindings/tutorials/Submitting-and-Managing-Jobs.html">here</a>, but as a quick example, the following script illustrates how you can use
Python to submit a number of jobs:
</p>

<div class="mdframed">
<div class="note">
<p>
The complete example can be found in the <code>examples/python_bindings</code> directory of
the <a href="https://github.com/angel-devicente/htcondor-iac">HTCondor@IAC</a> repository.  
</p>

</div>

</div>

<div class="mdframed">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #00ffff;">import</span> htcondor

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Define the parameters for the jobs</span>
<span style="color: #eedd82;">job_parameters</span> = [
    {<span style="color: #ffa07a;">"keyword"</span>: <span style="color: #ffa07a;">"initial_gas_density"</span>, <span style="color: #ffa07a;">"value"</span>: <span style="color: #ffa07a;">"0.400E+06"</span>},
    {<span style="color: #ffa07a;">"keyword"</span>: <span style="color: #ffa07a;">"initial_gas_density"</span>, <span style="color: #ffa07a;">"value"</span>: <span style="color: #ffa07a;">"1.460E+06"</span>},
    {<span style="color: #ffa07a;">"keyword"</span>: <span style="color: #ffa07a;">"initial_gas_density"</span>, <span style="color: #ffa07a;">"value"</span>: <span style="color: #ffa07a;">"3.200E+06"</span>},
]

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Create an HTCondor submit object</span>
<span style="color: #eedd82;">submit_description</span> = htcondor.Submit({
   <span style="color: #ffa07a;">"requirements"</span>: <span style="color: #ffa07a;">'OpSysAndVer == "Ubuntu22"'</span>,
    <span style="color: #ffa07a;">"executable"</span>: <span style="color: #ffa07a;">"job.sh"</span>,
    <span style="color: #ffa07a;">"arguments"</span>: <span style="color: #ffa07a;">"job.py $(ProcID) $(parameter) $(value)"</span>,
    <span style="color: #ffa07a;">"output"</span>: <span style="color: #ffa07a;">"outs/hostname.$(ProcID).out"</span>,       
    <span style="color: #ffa07a;">"error"</span>: <span style="color: #ffa07a;">"errors/hostname.$(ProcID).err"</span>,        
    <span style="color: #ffa07a;">"log"</span>: <span style="color: #ffa07a;">"hostname.log"</span>,
    <span style="color: #ffa07a;">"transfer_input_files"</span>: <span style="color: #ffa07a;">"job.py, parameters.ini"</span>,
    <span style="color: #ffa07a;">"transfer_output_files"</span>: <span style="color: #ffa07a;">"results"</span>,    
})

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Create itemdata (based on the job_parameters)</span>
<span style="color: #eedd82;">itemdata</span> = []
<span style="color: #00ffff;">for</span> i, params <span style="color: #00ffff;">in</span> <span style="color: #b0c4de;">enumerate</span>(job_parameters):
    itemdata.append({<span style="color: #ffa07a;">'parameter'</span>: params[<span style="color: #ffa07a;">'keyword'</span>], <span style="color: #ffa07a;">'value'</span>: params[<span style="color: #ffa07a;">'value'</span>]})

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Submit the jobs using the itemdata    </span>
<span style="color: #eedd82;">schedd</span> = htcondor.Schedd()                       
<span style="color: #eedd82;">submit_result</span> = schedd.submit(submit_description, itemdata = <span style="color: #b0c4de;">iter</span>(itemdata))

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Notify of the HTCondor job</span>
<span style="color: #b0c4de;">print</span>(f<span style="color: #ffa07a;">"Jobs submitted with Cluster ID: </span>{submit_result.cluster()}<span style="color: #ffa07a;">"</span>)
</pre>
</div>

</div>

<p>
A few things to note about this example are:
</p>
<ul class="org-ul">
<li><code>itemdata</code> is the mechanim used at submission (see call to <code>schedd.submit</code>) to
specify how many jobs will be submitted. In this case we build <code>itemdata</code> out
of the <code>job_parameters</code> list, so there will be three jobs. Each member of
<code>itemdata</code> is a dictionary, that specifies the values of the variables to use
for each job. For example, the <code>parameter</code> key is passed to each job as an
argument by using the syntax <code>$(parameter)</code> (see call to <code>htcondor.Submit</code>).</li>
<li>the description of a job is done via a <code>Submit</code> object. This is, in essence,
the Pythonic equivalent of a submit file, so the same variables, macros and
commands can be used (see section <a href="#Submit%20files">2</a>).</li>
<li>when you use the <code>condor_submit</code> command, HTCondor will, by default, make sure
that the jobs will be executed only in machines with the same operating system
version as the machine from where you submit the jobs. When you use the Python
bindings this is not the case, so we use the <code>requirements</code> command to specify
that in this case we only want to use execution machines with Ubuntu 22.</li>
<li>this example illustrates how to use Python to submit jobs, where each job is
itself a Python code (here executed via the <code>job.sh</code> wrapper), but this
doesn't have to be so. You could specify any other type of executable file
(for example a compiled code as in the examples in section <a href="#Examples">2.3</a>).
<ul class="org-ul">
<li>at the same time we also show how we can use software not installed in
default locations. In this example we want to use the Python 3.10
interpreter which we would normally use in an interactive session by
executing the command <code>module load python/3.10</code> (see the
<a href="../software/modules.html">Environment Modules</a> documentation). This is done by using the <code>job.sh</code>
wrapper script, and it is further explained in 
section <a href="#HTCondor%20and%20Environment%20Modules">4.2</a>.</li>
</ul></li>
</ul>

<div class="mdframed">
<div class="note">
<p>
In the example above, if we wanted to use the default system python we could set
the python interpreter itself (<code>/usr/bin/python3</code>) as the <code>executable</code>. But
HTCondor will, by default, transfer this to the executing directory, which is
most likely not what we want for system applications. To avoid this, we should
also set <code>tranfer_executable</code> to <code>false</code>.
</p>

</div>

</div>
</div>
</div>
</div>

<div id="outline-container-How-to%20Recipes" class="outline-2">
<h2 id="How-to%20Recipes"><span class="section-number-2">4</span> How-to Recipes</h2>
<div class="outline-text-2" id="text-4">
<div class="mdframed">
<div class="note">
<p>
All the files necessary for the recipes in this section can be found in the
<code>recipes</code> directory of the <a href="https://github.com/angel-devicente/htcondor-iac">HTCondor@IAC</a> repository. Bear in mind that these
recipes point to the best solution we have found to solve common problems that
you might encounter with the HTCondor facility at the IAC, but they are not
foolproof, so if you find a better solution or any problems with any of the
recipes, please let us know so we can try to fix them or find some other way
around the problem.
</p>

</div>

</div>
</div>

<div id="outline-container-HTCondor%20and%20Kerberos" class="outline-3">
<h3 id="HTCondor%20and%20Kerberos"><span class="section-number-3">4.1</span> HTCondor and Kerberos</h3>
<div class="outline-text-3" id="text-4-1">
<div class="mdframed">
<div class="warning">
<p>
You should only try to follow this recipe if you find no other way to avoid the
use of Kerberos protected resources from within your HTCondor jobs, which in most
cases you will be able to by using the <a href="https://htcondor.readthedocs.io/en/latest/users-manual/file-transfer.html">HTCondor's File Transfer Mechanism</a>. 
</p>

</div>

</div>

<p>
<i>The files for this recipe are in directory <a href="https://github.com/angel-devicente/htcondor-iac/tree/main/recipes/condor_kerberos"><code>condor_kerberos</code></a>.</i>
</p>

<p>
At the IAC we use Kerberos for authentication. While the details of Kerberos are
beyond the scope of this manual, let's just say that you need a <i>ticket</i> when
you want to access some Kerberos protected resource (like your <code>/home</code> directory
or the <code>/net/nas/[...]</code> ones), and that these tickets are only valid for a
certain amount of time. If you try to run a HTCondor job that uses some Kerberos
protected resource you will quickly start having problems: you do not have a
valid ticket in the executing machine or the ticket has expired. 
</p>

<p>
In order to avoid these problems, you can do the following (step #1 is only
needed once, in order to generate a file that you can use for as many times as
you wish):
</p>

<ul class="org-ul">
<li><p>
Create a Kerberos <i>keytab</i> file, compatible with Active Directory
</p>

<p>
The following information was taken from <a href="https://www.itadmintools.com/2011/07/creating-kerberos-keytab-files.html">here</a>:
</p>

<pre class="example">
$ ktutil  
ktutil:  addent -password -p &lt;username&gt;@IAC.ES -k 1 -e RC4-HMAC 
Password for &lt;username&gt;@IAC.ES: 
ktutil:  wkt krb_keytab
ktutil:  q 
$
</pre>

<p>
The <i>keytab</i> file is created by default with read/write permissions only for the
owner, but in any case you should keep it in a safe place and don't let anyone
else access it. You can check that the <i>keytab</i> file can be used to obtain a
Kerberos ticket without having to type in your password again by doing:
</p>

<pre class="example">
$ kinit &lt;username&gt;@IAC.ES -k -t krb_keytab
</pre>

<p>
If the <i>keytab</i> is working without problems, copy it to the <code>condor_kerberos</code>
directory.
</p></li>

<li>The job that we are submitting for this recipe uses the same <b>C</b> source file
as that described in section <a href="#Basic%20HTCondor%20workflow">1.7</a>, so you just have to
compile it as explained there.</li>

<li><p>
Submit the job with <code>condor_submit kerberos.submit</code>. If you inspect this
<i>submit file</i>, you will see that the executable is named <code>kerberos.sh</code>, which
you should leave as is. Also, there is a <code>Kerberos section</code>, which you should
leave as is for now, except for:
</p>
<ul class="org-ul">
<li><code>&lt;user_id&gt;</code>, which is you user Linux ID number, that you can obtain by
running <code>id -u</code></li>
<li>the actual executable name, which in this example is called <code>simple</code>, but
you will have to adapt it to your particular case.</li>
</ul>

<p>
The <code>kerberos.sh</code> file has two <code>DO NOT EDIT</code> sections dealing with the
creation of Kerberos tickets, and the instructions to run your executable go
in the middle (in this recipe we are just running the <code>simple</code> executable, and
then we are listing the contents of our <code>/home</code> directory (for which we need a
valid Kerberos ticket). In case you are not familiar with <code>bash</code>, the line
<code>./simple $1 $2</code> will execute the <code>simple</code> file, using as arguments the two
arguments specified in the <code>kerberos.submit</code> file.
</p></li>
</ul>
</div>
</div>


<div id="outline-container-HTCondor%20and%20Environment%20Modules" class="outline-3">
<h3 id="HTCondor%20and%20Environment%20Modules"><span class="section-number-3">4.2</span> HTCondor and Environment Modules</h3>
<div class="outline-text-3" id="text-4-2">
<p>
HTCondor jobs get executed in a "clean" environment, which means that many of
the variables available in a regular shell session will not be available by
default for HTCondor jobs. At the same time, the usage of Kerberos at the IAC
makes it difficult to access (see section <a href="#HTCondor%20and%20Kerberos">4.1</a>) your shell
init files (<code>.bashrc</code>, <code>.bash_profile</code>, etc.). Thus, you will likely run into
troubles with HTCondor if you are used to running <a href="../software/modules.html">Environment Modules</a> (for
example, by running <code>module load python/3.10</code>) to prepare the environment for
your executions. In these cases the best option is to create a simple wrapper
script that will take care of preparing the environment, loading the required
modules and then launching the actual job.
</p>

<p>
For example, when using an interactive shell, if we want to use the Python
interpreter (and packages) provided by the module <code>python/3.10</code> available in all
IAC <i>burros</i> with Ubuntu22, we would do:
</p>

<div class="org-src-container">
<pre class="src src-bash">$ module load python/3.10
$ python3 job.py [args]
</pre>
</div>

<p>
Then, to do the same with HTCondor, we would simply need to create a wrapper
script (<code>job.sh</code>) like the following:
</p>

<div class="mdframed">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #ff7f24;">#</span><span style="color: #ff7f24;">!/bin/</span><span style="color: #00ffff;">bash</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Prepare the environment </span>
<span style="color: #b0c4de;">source</span> /usr/local/glob/SIE/.bashrc_SIE
<span style="color: #b0c4de;">export</span> <span style="color: #eedd82;">USER</span>=nouser

module load python/3.10  <span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">load modules</span>

python3 <span style="color: #ffa07a;">"$@"</span>             <span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">launch job </span>
</pre>
</div>

</div>

<p>
and set the HTCondor <code>executable</code> command to <code>job.sh</code>, and its <code>arguments</code> to
<code>job.py [args]</code>. For a worked-out example of this, see section <a href="#HTCondor%20from%20Python">3.6</a>. 
</p>
</div>
</div>
</div>

<div id="outline-container-Acknowledging%20HTCondor%20in%20publications" class="outline-2">
<h2 id="Acknowledging%20HTCondor%20in%20publications"><span class="section-number-2">5</span> Acknowledging HTCondor in publications</h2>
<div class="outline-text-2" id="text-5">
<p>
It is important that you acknowledge HTCondor in any publication of your work
where you have used HTCondor (and we would be grateful if you could send us the
details of the published paper). This will help us to improve the visibility of
the HTCondor@IAC facility and ensure that it is available at the IAC for the
foreseable future. Although there is no standard acknowledgment format, we
suggest the following:
</p>

<div class="mdframed">
<div class="important">
<p>
This paper made use of the IAC HTCondor facility
(<a href="http://research.cs.wisc.edu/htcondor/">http://research.cs.wisc.edu/htcondor/</a>), partly financed by the Ministry of
Economy and Competitiveness with FEDER funds, code IACA13-3E-2493.
</p>

</div>

</div>
</div>
</div>

<div id="outline-container-Further%20information%20and%20support" class="outline-2">
<h2 id="Further%20information%20and%20support"><span class="section-number-2">6</span> Further information and support</h2>
<div class="outline-text-2" id="text-6">
<p>
This manual is only a brief introduction to all HTCondor has to offer. For
detailed and complete information, check the official <a href="https://htcondor.readthedocs.io/en/latest/">HTCondor Manual</a>.
</p>

<p>
If you need help or you are having any kind of issues related to HTCondor,
the <a href="http://research.iac.es/sieinvens/SINFIN/Main/index.php">SIE</a> gives direct support to IAC's users who want to use HTCondor: we
will not code your whole application, but we will help and advise you on how to
get the most out of HTCondor. 
</p>

<p>
If you want to stay informed about HTCondor@IAC updates, tips, etc., subscribe
to the HTCondor@IAC <i>stream</i> (<b>#computing/htcondor</b>) in IAC-Zulip 
</p>
<a href="https://iac-es.zulipchat.com"><img src="https://img.shields.io/badge/zulip-join_chat-brightgreen.svg" /></a>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Ángel de Vicente</p>
<p class="email">Email: <a href="mailto:angel.de.vicente@iac.es">angel.de.vicente@iac.es</a></p>
<p class="date">Created: 2023-10-21 Sat 09:48</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
